<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Book Gallery</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 16px;
  }

  h1 {
    margin-top: 0;
    margin-bottom: 8px;
  }

  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
    margin-bottom: 8px;
  }

  select, input, button {
    padding: 4px 6px;
    font-size: 14px;
  }

  #viewer {
    text-align: center;
    margin-bottom: 8px;
  }

  #mainImage {
    max-width: 100%;
    max-height: 80vh;
    border: 1px solid #aaa;
    box-shadow: 0 0 4px rgba(0,0,0,0.3);
  }

  /* Horizontal thumbnail strip */
  #thumbStrip {
    display: flex;
    flex-direction: row;
    gap: 6px;
    overflow-x: auto;
    padding: 4px 0;
    border-top: 1px solid #ccc;
    margin-top: 4px;
  }

  .thumb {
    height: 80px;
    flex: 0 0 auto;
    border: 1px solid #ccc;
    cursor: pointer;
  }

  .thumb.selected {
    border: 3px solid #0074d9;
  }

  /* Password gate */
  #lockScreen {
    position: fixed;
    inset: 0;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  #lockInner {
    background: white;
    border: 1px solid #ccc;
    padding: 20px 24px;
    width: 320px;
    box-shadow: 0 0 8px rgba(0,0,0,0.25);
  }

  #lockError {
    color: #b00020;
    min-height: 16px;
    margin-bottom: 6px;
  }

  #app { display: none; }
</style>
</head>
<body>

<!-- Password -->
<div id="lockScreen">
  <div id="lockInner">
    <h2>Access</h2>
    <p>What’s your favourite subject?</p>
    <div id="lockError"></div>
    <input id="lockInput" type="text" placeholder="Answer here" />
    <button id="lockButton">Enter</button>
  </div>
</div>

<!-- Main App -->
<div id="app">
  <h1 id="title">Gallery</h1>

  <div class="controls">
    <label>Book:
      <select id="bookSelect"></select>
    </label>

    <label>Page:
      <select id="pageSelect"></select>
    </label>

    <label>Go:
      <input id="pageInput" type="text" size="4" placeholder="123" />
      <button id="pageGoButton">Go</button>
    </label>
  </div>

  <div id="viewer">
    <img id="mainImage" />
  </div>

  <div id="thumbStrip"></div>
</div>

<!-- Your page index from Python -->
<script src="books/index.js"></script>

<script>
  const OFFSET = 10;

  const app          = document.getElementById("app");
  const titleEl      = document.getElementById("title");
  const bookSelect   = document.getElementById("bookSelect");
  const pageSelect   = document.getElementById("pageSelect");
  const pageInput    = document.getElementById("pageInput");
  const pageGoButton = document.getElementById("pageGoButton");
  const mainImage    = document.getElementById("mainImage");
  const thumbStrip   = document.getElementById("thumbStrip");

  const lockScreen   = document.getElementById("lockScreen");
  const lockInput    = document.getElementById("lockInput");
  const lockButton   = document.getElementById("lockButton");
  const lockError    = document.getElementById("lockError");

  let currentBook  = null;
  let pages        = [];
  let currentIndex = 0;
  let thumbEls     = [];

  /* ------------------ PASSWORD ------------------ */

  function tryUnlock() {
    const ans = (lockInput.value || "").trim().toLowerCase();
    if (ans === "maths") {
      lockScreen.style.display = "none";
      app.style.display = "block";
      init();
    } else {
      lockError.textContent = "Incorrect. Try again.";
      lockInput.value = "";
      lockInput.focus();
    }
  }

  lockButton.onclick = tryUnlock;
  lockInput.onkeydown = e => { if (e.key === "Enter") tryUnlock(); };

  /* ------------------ GALLERY INIT ------------------ */

  function init() {
    const books = Object.keys(window.BOOK_DATA).sort();

    books.forEach(book => {
      const opt = document.createElement("option");
      opt.value = book;
      opt.textContent = book;
      bookSelect.appendChild(opt);
    });

    const params = new URLSearchParams(window.location.search);
    const urlBook = params.get("book");
    const initial = (urlBook && books.includes(urlBook)) ? urlBook : books[0];

    bookSelect.value = initial;
    loadBook(initial);

    document.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft")  showPage(currentIndex - 1);
      if (e.key === "ArrowRight") showPage(currentIndex + 1);
    });
  }

  function loadBook(book) {
    currentBook  = book;
    pages        = window.BOOK_DATA[book];
    currentIndex = 0;

    titleEl.textContent = "Gallery – " + book;

    buildPageDropdown();
    buildThumbStrip();

    if (pages.length > 0) showPage(0);
  }

  /* ------------------ PAGE CONTROLS ------------------ */

  function buildPageDropdown() {
    pageSelect.innerHTML = "";
    pages.forEach((file, idx) => {
      const opt = document.createElement("option");
      const printed = (idx + 1 - OFFSET);
      const printedLabel = printed.toString().padStart(3, "0");
      opt.value = idx;
      opt.textContent = printedLabel;
      pageSelect.appendChild(opt);
    });
    pageSelect.value = "0";
  }

  function buildThumbStrip() {
    thumbStrip.innerHTML = "";
    thumbEls = [];

    pages.forEach((file, idx) => {
      const img = document.createElement("img");
      img.src = `books/${currentBook}/thumbs/${file}`;
      img.className = "thumb";
      img.onclick = () => showPage(idx);
      thumbStrip.appendChild(img);
      thumbEls.push(img);
    });
  }

  function showPage(idx) {
    if (idx < 0 || idx >= pages.length) return;

    currentIndex = idx;
    const file = pages[idx];
    mainImage.src = `books/${currentBook}/${file}`;
    pageSelect.value = idx;

    thumbEls.forEach((el, i) =>
      el.classList.toggle("selected", i === idx)
    );

    thumbEls[idx].scrollIntoView({ behavior: "smooth", inline: "center" });
  }

  /* ------------------ JUMP TO PAGE ------------------ */

  function goToPageFromInput() {
    const raw = pageInput.value.trim();
    if (!raw) return;

    const printed = parseInt(raw, 10);
    if (isNaN(printed)) return;

    // YOUR CORRECT OFFSET:
    // printed 14 → 24 → 024.webp
    // printed 6  → 16 → 016.webp
    let internal = printed + OFFSET;

    if (internal < 1) internal = 1;
    if (internal > pages.length) internal = pages.length;

    const idx = internal - 1;
    showPage(idx);
  }

  pageInput.onkeydown = e => { if (e.key === "Enter") goToPageFromInput(); };
  pageGoButton.onclick = goToPageFromInput;
  pageSelect.onchange = () => showPage(parseInt(pageSelect.value));
  bookSelect.onchange = () => loadBook(bookSelect.value);

</script>

</body>
</html>
