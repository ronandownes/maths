<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Formula & Tables Viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin:0;
    background:#f3f3f3;
    font-family:"Segoe UI",Arial,sans-serif;
    display:flex;
    height:100vh;
    overflow:hidden;
  }

  /* LEFT THUMBNAIL SIDEBAR */
  #sidebar {
    width:140px;
    background:white;
    overflow-y:auto;
    border-right:2px solid #ddd;
    padding:10px;
    transition: opacity 0.3s;
  }

  #sidebar img {
    width:100%;
    border-radius:6px;
    margin-bottom:8px;
    cursor:pointer;
    opacity:0.6;
    transition:0.2s;
  }

  #sidebar img.active {
    opacity:1;
    box-shadow:0 0 6px #7a1c1c;
  }

  /* MAIN VIEW AREA */
  #mainArea {
    flex:1;
    display:flex;
    flex-direction:column;
    align-items:center;
    overflow:hidden;
    position:relative;
  }

  .navbar {
    width:100%;
    background:#7a1c1c;
    padding:12px 20px;
    display:flex;
    gap:25px;
    transition: opacity 0.3s;
  }
  .navbar a {
    color:white;
    font-weight:bold;
    text-decoration:none;
  }

  /* DROPDOWNS */
  #controls {
    margin-top:8px;
    display:flex;
    gap:12px;
    justify-content:center;
    transition: opacity 0.3s;
  }

  select {
    padding:8px 12px;
    border-radius:6px;
    border:1px solid #aaa;
    font-size:0.95rem;
  }

  /* MAIN IMAGE */
  #mainImage {
    max-width:72%;
    max-height:80vh;
    margin-top:15px;
    border-radius:10px;
    box-shadow:0 4px 18px rgba(0,0,0,0.3);
    transition:0.2s;
    cursor: zoom-in;
    user-select: none;
  }

  #mainImage.zoomed {
    cursor: zoom-out;
    max-width: none;
    max-height: none;
    transform-origin: center center;
  }

  #mainImage.dragging {
    cursor: grab !important;
  }

  #mainImage.dragging:active {
    cursor: grabbing !important;
  }

  #imageContainer {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    width: 100%;
  }

  #imageContainer.zoomed {
    overflow: auto;
    align-items: flex-start;
    justify-content: flex-start;
  }

  #imageContainer.zoomed img {
    min-width: 100%;
    min-height: 100%;
  }

  #imageContainer.draggable {
    cursor: grab !important;
  }

  #imageContainer.dragging {
    cursor: grabbing !important;
  }

  body.fullscreen #mainImage {
    max-height: 100vh;
  }

  /* ARROWS */
  .arrow {
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    font-size:3rem;
    color:#7a1c1c;
    cursor:pointer;
    user-select:none;
    background:rgba(255,255,255,0.7);
    padding:8px 14px;
    border-radius:10px;
    z-index:20;
  }
  #leftArrow { left:10px; }
  #rightArrow { right:10px; }

  /* FULLSCREEN MODE */
  body.fullscreen #sidebar,
  body.fullscreen .navbar,
  body.fullscreen #controls {
    opacity: 0;
    pointer-events: none;
  }

</style>
</head>

<body>

<!-- LEFT SIDEBAR THUMBNAILS -->
<div id="sidebar"></div>

<!-- MAIN VIEW AREA -->
<div id="mainArea">

  <nav class="navbar">
    <a href="index.html">Home</a>
    <a href="ft_gallery.html">Formula Tables</a>
  </nav>

  <!-- TOP DROPDOWNS -->
  <div id="controls">
    <select id="topicSelect">
      <option value="">Jump to topic…</option>
    </select>

    <select id="pageSelect">
      <option value="">Page number…</option>
    </select>
  </div>

  <div id="leftArrow" class="arrow">&#10094;</div>
  <div id="rightArrow" class="arrow">&#10095;</div>

  <div id="imageContainer">
    <img id="mainImage">
  </div>
</div>

<script>
// ===============================
// FT PAGES
// ===============================
const pages = [
  "001","002","003","004","005","006","007","008","009","010",
  "011","012","013","014","015","016","017","018","019","020",
  "021","022","023","024","025","026","027","028","029","030",
  "031","032","033","034","035","036","037","038","039","040",
  "041","042","043","044","045","046","047","048","049","050",
  "051","052","053","054","055","056","057","058","059","060",
  "061","062","063","064","065","066","067","068","069","070",
  "071","072","073","074","075","076","077","078","079","080",
  "081","082","083","084","085","086","087","088","089","090",
  "091","092","093","094"
];

// ===============================
// TOPICS → pages
// ===============================
const topics = {
  "Length and area": "008",
  "Surface area and volume": "010",
  "Area approximations": "012",
  "Trigonometry": "013",
  "Geometry": "017",
  "Coordinate geometry": "018",
  "Algebra": "020",
  "Indices and logarithms": "021",
  "Sequences and series": "022",
  "Sets and logic": "023",
  "Calculus": "025",
  "Economics": "028",
  "Financial mathematics": "030",
  "Statistics and probability": "033",
  "Units of measurement": "044",
  "Fundamental physical constants": "046",
  "Particle physics": "048",
  "Mechanics": "050",
  "Heat and temperature": "058",
  "Light and sound": "059",
  "Geometric optics": "060",
  "Electricity": "061",
  "Radioactivity": "063",
  "Chemistry": "064",
  "Symbols & units": "065",
  "Electrical circuit symbols": "072",
  "The elements": "079",
  "Table of nuclides": "083",
  "Elements (by symbol)": "091"
};

// ===============================
// STATE VARIABLES
// ===============================
const mainImage = document.getElementById("mainImage");
const imageContainer = document.getElementById("imageContainer");
let currentPage = new URLSearchParams(location.search).get("page") || "001";
let isZoomed = false;
let zoomLevel = 1;
let isDragging = false;
let dragStartX = 0;
let dragStartY = 0;
let scrollStartX = 0;
let scrollStartY = 0;
let spacePressed = false;

// ===============================
// Populate topic dropdown
// ===============================
const topicSelect = document.getElementById("topicSelect");
for (let t in topics) {
  let opt = document.createElement("option");
  opt.value = topics[t];
  opt.textContent = t;
  topicSelect.appendChild(opt);
}

// ===============================
// Populate page dropdown
// ===============================
const pageSelect = document.getElementById("pageSelect");
pages.forEach(pg => {
  let opt = document.createElement("option");
  opt.value = pg;
  opt.textContent = "Page " + pg;
  pageSelect.appendChild(opt);
});

// ===============================
// Load main page + update highlights
// ===============================
function loadPage(pg) {
  currentPage = pg;
  mainImage.src = "books/ft/" + pg + ".webp";
  pageSelect.value = pg;

  // highlight sidebar
  document.querySelectorAll("#sidebar img").forEach(img => {
    img.classList.toggle("active", img.dataset.page === pg);
  });

  // Reset zoom when changing pages
  resetZoom();
}

// ===============================
// Build sidebar thumbnails
// ===============================
const sidebar = document.getElementById("sidebar");

pages.forEach(pg => {
  const img = document.createElement("img");
  img.src = "books/ft/thumbs/" + pg + ".webp";
  img.dataset.page = pg;
  img.onclick = () => loadPage(pg);
  sidebar.appendChild(img);
});

// ===============================
// Topic jump
// ===============================
topicSelect.onchange = function() {
  if (!this.value) return;
  loadPage(this.value);
};

// ===============================
// Page dropdown jump
// ===============================
pageSelect.onchange = function() {
  if (!this.value) return;
  loadPage(this.value);
};

// ===============================
// Arrows
// ===============================
document.getElementById("leftArrow").onclick = () => {
  let i = pages.indexOf(currentPage);
  if (i > 0) loadPage(pages[i - 1]);
};

document.getElementById("rightArrow").onclick = () => {
  let i = pages.indexOf(currentPage);
  if (i < pages.length - 1) loadPage(pages[i + 1]);
};

// ===============================
// ZOOM FUNCTIONS
// ===============================
function resetZoom() {
  isZoomed = false;
  zoomLevel = 1;
  mainImage.classList.remove('zoomed');
  mainImage.style.transform = 'scale(1)';
  imageContainer.classList.remove('zoomed');
}

function toggleZoom(e) {
  if (!isZoomed) {
    isZoomed = true;
    zoomLevel = 2;
    mainImage.classList.add('zoomed');
    mainImage.style.transform = 'scale(2)';
    imageContainer.classList.add('zoomed');
    
    // Center the scroll position
    requestAnimationFrame(() => {
      const maxScrollX = imageContainer.scrollWidth - imageContainer.clientWidth;
      const maxScrollY = imageContainer.scrollHeight - imageContainer.clientHeight;
      imageContainer.scrollLeft = maxScrollX / 2;
      imageContainer.scrollTop = maxScrollY / 2;
    });
  } else {
    resetZoom();
  }
  e.stopPropagation();
}

// Double-click to zoom
mainImage.addEventListener('dblclick', toggleZoom);

// Mouse wheel to zoom
mainImage.addEventListener('wheel', (e) => {
  e.preventDefault();
  e.stopPropagation();
  
  if (e.deltaY < 0) {
    // Zoom in
    zoomLevel = Math.min(zoomLevel + 0.2, 4);
  } else {
    // Zoom out
    zoomLevel = Math.max(zoomLevel - 0.2, 1);
  }
  
  if (zoomLevel > 1) {
    const wasZoomed = isZoomed;
    isZoomed = true;
    mainImage.classList.add('zoomed');
    mainImage.style.transform = `scale(${zoomLevel})`;
    imageContainer.classList.add('zoomed');
    
    // Only center on first zoom
    if (!wasZoomed) {
      requestAnimationFrame(() => {
        const maxScrollX = imageContainer.scrollWidth - imageContainer.clientWidth;
        const maxScrollY = imageContainer.scrollHeight - imageContainer.clientHeight;
        imageContainer.scrollLeft = maxScrollX / 2;
        imageContainer.scrollTop = maxScrollY / 2;
      });
    }
  } else {
    resetZoom();
  }
}, { passive: false });

// ===============================
// DRAG TO PAN (with spacebar)
// ===============================
imageContainer.addEventListener('mousedown', (e) => {
  if (spacePressed && isZoomed) {
    isDragging = true;
    dragStartX = e.clientX;
    dragStartY = e.clientY;
    scrollStartX = imageContainer.scrollLeft;
    scrollStartY = imageContainer.scrollTop;
    imageContainer.classList.add('dragging');
    imageContainer.classList.remove('draggable');
    e.preventDefault();
    e.stopPropagation();
  }
});

document.addEventListener('mousemove', (e) => {
  if (isDragging && spacePressed && isZoomed) {
    e.preventDefault();
    e.stopPropagation();
    const deltaX = dragStartX - e.clientX;
    const deltaY = dragStartY - e.clientY;
    imageContainer.scrollLeft = scrollStartX + deltaX;
    imageContainer.scrollTop = scrollStartY + deltaY;
  }
});

document.addEventListener('mouseup', (e) => {
  if (isDragging) {
    isDragging = false;
    imageContainer.classList.remove('dragging');
    if (spacePressed && isZoomed) {
      imageContainer.classList.add('draggable');
    }
    e.preventDefault();
    e.stopPropagation();
  }
});

// ===============================
// KEYBOARD CONTROLS
// ===============================
document.addEventListener("keydown", e => {
  let i = pages.indexOf(currentPage);
  
  if (e.key === "ArrowLeft" && i > 0) {
    loadPage(pages[i - 1]);
  }
  if (e.key === "ArrowRight" && i < pages.length - 1) {
    loadPage(pages[i + 1]);
  }
  if (e.key === " " && !spacePressed) {
    spacePressed = true;
    if (isZoomed) {
      imageContainer.classList.add('draggable');
    }
    e.preventDefault();
  }
});

document.addEventListener("keyup", e => {
  if (e.key === " ") {
    spacePressed = false;
    isDragging = false;
    imageContainer.classList.remove('draggable');
    imageContainer.classList.remove('dragging');
  }
});

// ===============================
// CLICK NAVIGATION & FULLSCREEN
// ===============================
document.addEventListener('click', (e) => {
  // Don't toggle if clicking on controls or sidebar
  if (e.target.closest('#controls') || e.target.closest('#sidebar') || e.target.closest('.navbar')) {
    return;
  }
  
  // Don't toggle if clicking arrows
  if (e.target.closest('.arrow')) {
    return;
  }
  
  // Don't toggle if image is zoomed
  if (isZoomed) {
    return;
  }
  
  // Check if clicking in left or right navigation zones
  const clickX = e.clientX;
  const windowWidth = window.innerWidth;
  const navZoneWidth = windowWidth * 0.25;
  
  if (clickX < navZoneWidth) {
    // Left zone - previous page
    let i = pages.indexOf(currentPage);
    if (i > 0) loadPage(pages[i - 1]);
    return;
  } else if (clickX > windowWidth - navZoneWidth) {
    // Right zone - next page
    let i = pages.indexOf(currentPage);
    if (i < pages.length - 1) loadPage(pages[i + 1]);
    return;
  }
  
  // Middle zone - toggle fullscreen
  document.body.classList.toggle('fullscreen');
});

// ===============================
// Swipe gestures (mobile)
// ===============================
let startX = 0;

document.addEventListener("touchstart", e => {
  startX = e.changedTouches[0].screenX;
});

document.addEventListener("touchend", e => {
  let dx = e.changedTouches[0].screenX - startX;
  let i = pages.indexOf(currentPage);

  if (dx > 60 && i > 0) {
    loadPage(pages[i - 1]);
  }

  if (dx < -60 && i < pages.length - 1) {
    loadPage(pages[i + 1]);
  }
});

// ===============================
// Initial load & fullscreen timer
// ===============================
loadPage(currentPage);

setTimeout(() => {
  document.body.classList.add('fullscreen');
}, 1000);

</script>

</body>
</html>